# 복제
여러 서버가 서로의 역할을 나누어 정보를 동기화하는 것을 의미한다. 복제의 가장 큰 목적은 서비스중인 MongoDB 인스턴스에 문제가 생겼을때 다른 복제본을 이용해 문제가 생긴 인스턴스를 대체하는 것이다.
이런 환경을 고가용성 환경이라고도 한다.

- 복제세트 : 복제를 수행하기위한 인스턴스의 묶음
- 프라이머리 구성원 : 클라이언트와 읽기 및 쓰기작업을 함
- 세컨더리 구성원 : 프라이머리 구성원의 정보를 동기화
- 아비터 구성원 : 정보를 저장하지않고 복제 세트의 복구를 돕는다.

### 구성원 공통 기능
기본적으로 돌발 상황에 대비하기 위한 기능을 가지고 있다. 구성원이 서로 살아있는치 10초마다 핑을 날리는 하트비트 작업을 수행한다.

### 프라이머리 구성원
- 클라이언트와 소통하면서 직접적으로 정보를 읽고 쓰는 작업을 함
- 각각의 복제 세트에서 하나만 존재

### 세컨더리 구성원
- 프라이머리 서버의 변경된 정보를 지속적으로 동기화
- 프라이머리 서버에 문제 발생시 세컨더리 구성원 중 하나가 프라이머리 구성원이 됨
- 우선순위 값을 정하여 프라이머리 후보로 나올 수 있게 된다.
- 읽기 요청 분담 : 읽기 선호 설정을 변경하게되면 클라이언트가 세컨더리로부터 정보를 읽어오게 만들 수 있음.
- 지연된 복제 구성원: 프라이머리의 정보를 일정 시간 늦게 반영하는 기능 (ex. 롤백을 위해서)

### 아비터 구성원
- 프라이머리로부터 정보를 복제하지 않음
- 정보를 가지고있지 않으므로 후보가 될 수 없음
- 선거가 개최되면 세컨더리의 상태를 보고 투표만 가능.
- 최소한의 비용으로 복제를 유지시키기위해 사용하면 좋음.

## 복제 세트의 선거
복제 세트의 장애를 감지하면 우선순위가 높은 세컨더리가 선거를 개최하고 후보가 된다. 
일정 시간 과반의 표를 받으면 후보 세컨더리가 프라이머리가 되고 선거가 종료된다. 
- 하나의 복제 세트에는 최대 일곱개의 구성원만이 투표권을 가질 수 있다.
- 선거가 끝나고 프라이머리보다 최신의 정보를 가지고있는 세컨더리가 있을 경우 구성원은 프라이머리가 가지고있는 정보에 맞춰서 롤백을 수행한다. (동기화를 위해서)
- 소실되지 말아야할 정보를 저장해야하는 경우 WriteConcern 옵션을 보수적으로 설정한다.
